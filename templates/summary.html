{% extends 'base.html' %}
{% block content %}



  <h2>Summary</h2>

<h4>  {{ first_name }} {{ last_name }} <br>
 Total payments received from pharmaceutical companies in 2015: ${{ session['info_doc']['total_received'] }} </h4> <br>

<!-- info related to doctor that appear on top of the page -->
<div>
    {{ perso_doc_info['specialty'] }} <br>
    {{ perso_doc_info['street_address'] }} {{ perso_doc_info['zipcode' ] }} {{ perso_doc_info['city' ] }} 

</div>

<div>
    <!-- replace with a pie chart with JS chart or plython tool -->
    <br><b>In 2015: </b> 
    <ul>
        {% for name, payment in pay_breakdown %}

            <li> {{ name }} paid a total of  ${{ payment }} - {{ (payment*100/session['info_doc']['total_received'])|round|int }}% of total payments received </li>
        {% endfor %}
    </ul>
</div>
<!-- button to access other pages -->
<span>
    <form method="get" action="/ind_comparison/{{ p_id }}/{{ perso_doc_info['specialty'] }}/{{ perso_doc_info['state'] }}">
    <button type="submit">Compare with peers</button>
    </form>


    <form method="get" action="/doctor_like">
    <button type="submit">Access Doctor Ratings</button>
    </form>
</span>



<div class="summary-chart" style="height: 300px; width: 50%;">
    <canvas id="docChart" height:'256' width:'256'></canvas>
    <div id="docLegend" class="chart-legend"></div>
  </div>

<!-- Chart part -->
<script>

// put stuff in options

var options = { responsive: true, maintainAspectRatio: true,
       
                title: {            
                    display: true,
                    text: 'Payments received by this doctor'
                },
                legend: {
                display: true},   
                tooltips: { 
                    callbacks: {
                    label: function(tooltipItem, data) {
                    var allData = data.datasets[tooltipItem.datasetIndex].data;
                    var tooltipLabel = data.labels[tooltipItem.index];
                    var tooltipData = allData[tooltipItem.index];
                    var total = 0;
                    for (var i in allData) {
                        total += allData[i];
                                            }
                    var tooltipPercentage = Math.round((tooltipData / total) * 100);
                    return tooltipLabel + ': $' + tooltipData + ' (' + tooltipPercentage + '%)';
                                                        }
                             }
                    // enabled: true,
                    // mode: 'x-axis'
                },
                animation:{animateRotate: true, animateScale: true} 
                };


var ctx_donut = $("#docChart").get(0).getContext("2d");

$.get("/doc_info.json", function (data) {
    var mydocChart = new Chart(ctx_donut, {
                                            type: 'doughnut',
                                            data: data,
                                            options: options,
                                            });

});

</script>

{% endblock %}
